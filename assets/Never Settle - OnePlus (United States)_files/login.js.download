+function(a){"use strict";a(function(){function b(c,d){var f,g=c||window.modules.misc.parseQuery(),h=a("#_net_host").val(),i=a("#_india_host").val();f=d?e?i:h:i,g._ssoid&&a.ajax({type:"post",url:f+"/xman/user/synclogin",data:g,dataType:"json",xhrFields:{withCredentials:!0},success:function(a){1!=a.ret&&b.tryReconnectCount--&&b(g)},error:function(){b.tryReconnectCount--&&b(g)}})}var c=window.location.hostname,d=(modules&&modules.misc&&modules.misc.domain||{},modules&&modules.misc&&modules.misc.topDomain||{}),e=c.indexOf(d.net)>-1,f=c.indexOf("account."+d.net)>-1;b.tryReconnectCount=1,f&&b(),window.modules.syncLoginToIndia=b;var g=function(){function b(a){d.addClass("hidden"),e.find(".user-name").text(decodeURIComponent(a)),e.removeClass("hidden"),d.find("form").length&&d.find("form")[0].reset()}var c=a(".js-off-canvas.js-log-in"),d=c.find(".js-before-logged-in"),e=c.find(".logged-in"),f=a("#offCanvasLoginEmail"),g=a("#offCanvasLoginPassword"),h=a("#offCanvasLogin"),i=a("#offCanvasSignOut");!function(){!function(){if(modules&&modules.misc&&modules.misc.cookieTool){var a=modules.misc.cookieTool.getItem("ONEPLUSID");if(a){var c=modules.misc.cookieTool.getItem("username");modules&&modules.misc&&modules.misc.urldecode&&(c=modules.misc.urldecode(c)),b(c)}}}()}();var j=function(){var c={};c.email=f.val(),c.password=g.val(),c.recaptcha=a("#g-recaptcha-response").val(),modules&&modules.misc&&modules.misc.load&&modules.misc.load.start();var d=this;modules&&modules.misc&&(d.trafficControl=new modules.misc.TrafficControl(a(d))),a.ajax({type:"POST",url:ONEPLUS_NET.REQUEST.LOG_IN,data:c,dataType:"json",success:function(c){modules&&modules.misc&&modules.misc.load&&modules.misc.load.finish(),1===c.ret?(d.trafficControl.clear(),b(c.data.username),window.bus&&window.bus.$emit("signed-in")):10086===c.ret?window.location.href=a("#link-sign-in").val()+"?email="+f.val():d.trafficControl.hint(c.errMsg),1===c.ret&&60===c.errCode&&d.trafficControl.init()},timeout:3e4,error:function(a,b,c){modules&&modules.misc&&modules.misc.load&&modules.misc.load.finish()}})},k=function(){modules&&modules.misc&&modules.misc.load&&modules.misc.load.start(),a.ajax({type:"GET",url:ONEPLUS_NET.REQUEST.LOG_OUT,dataType:"jsonp",success:function(b){modules&&modules.misc&&modules.misc.load&&modules.misc.load.finish(),1===b.ret?(d.removeClass("hidden"),e.addClass("hidden"),a.ajax({type:"POST",url:ONEPLUS_NET.REQUEST.SIGN_OUT,dataType:"json"}),modules&&modules.misc&&modules.misc.cache&&modules.misc.cache.remove("cart")):modules&&modules.misc&&modules.misc.dialog&&modules.misc.dialog.show(b.errMsg)},timeout:3e4,error:function(a,b,c){modules&&modules.misc&&modules.misc.load&&modules.misc.load.finish()}})};return h.on("inputValidated.oneplus",function(a){a.preventDefault(),a.stopPropagation(),j.call(this)}),i.on("click",function(a){a.preventDefault(),a.stopPropagation(),k()}),{AUTHOR:"Michael",VERSION:"1.0.0",LAST_MODIFIED:"2015-07-23",$element:c}}();window.modules=window.modules||{},window.modules.login=g})}(jQuery);